if (self.CavalryLogger) { CavalryLogger.start_js(["dHP7p"]); }

__d("MMessagesNewMessageBlockRenderer",["ActorURI","CurrentUser","DOM","HTML","MDynaTemplate","MMessagesBubbleMaker","MMessagesThreadImageRenderer","MMessageUtils","MRequest","XMessagingDeferredAttachmentController","emojiAndEmote","gkx","nullthrows"],(function(a,b,c,d,e,f){"use strict";var g="\xb7",h="text",i="deferred";function a(a,c){var d,e,f=b("gkx")("806617");e=b("nullthrows")((e=c)!=null?e.show_prim_webview_redesign:e);d=b("nullthrows")((d=c)!=null?d.user:d);d=e?d==a.getAuthorFBID():b("CurrentUser").getID()===a.getAuthorFBID();var g=a.getMessage(),h={};h.author_name=a.getAuthorName();h.author_href=c.author_href;h.message=g;var k=null;c.should_parse_emoticons&&(k=b("DOM").create("span",{},b("emojiAndEmote")(h.message,{isSupportedEmoji:c.is_supported_emoji,getMessengerEmote:c.get_messenger_emote})),h.message="");f&&g!==null&&g!==""&&(k=b("MMessagesBubbleMaker").createFromElement(k,d));var o;g=l(a);if(g===i){g=m(a);h.deferred_attachment_id=g;o=b("MDynaTemplate").renderToHtml(f?d?"@MDeferredAttachmentMessageRedesignSenderTemplate":"@MDeferredAttachmentMessageRedesignReceiverTemplate":"@MDeferredAttachmentMessageTemplate",h);g=b("XMessagingDeferredAttachmentController").getURIBuilder().setString("dest_id",g).setString("mid",a.getUUID()).setBool("from_viewer",d).getURI();g=b("ActorURI").create(g,c.page_id).toString();new(b("MRequest"))(g).setMethod("GET").send()}else o=b("MDynaTemplate").renderToHtml(f?d?"@MChatMessageRedesignSenderTemplate":"@MChatMessageRedesignReceiverTemplate":"@MChatMessageTemplate",h);g=new(b("HTML"))(o).getFragment().firstChild;if(!f||!d){h=b("DOM").find(g,"*","profile_image");b("DOM").replace(h,b("MMessagesThreadImageRenderer").participantImage(a.getAuthorFBID(),43,n(a)))}if(c.should_parse_emoticons){o=b("DOM").find(g,"div","message-text");o.appendChild(k)}if(!d&&a.getAuthorFBID()!==c.user&&!e){f=j(a.getMessageSource(),c.download_link);h=b("DOM").find(g,"div","action-list");b("DOM").appendContent(h,f)}return g}function j(a,c){var d=b("MMessageUtils").getMessageSourceText(a);if(!d)return"";var e="";k(a,c)?e=b("MDynaTemplate").renderToHtml("@MMessageSourceTextWithLinkTemplate",{text:d,download_href:c}):e=b("MDynaTemplate").renderToHtml("@MMessageSourceTextTemplate",{text:d});a=b("DOM").create("span",new(b("HTML"))(e));b("DOM").prependContent(a,new(b("HTML"))(" "+g+" "));return a}function k(a,b){return!(a==="source:chat:orca"||a==="source:titan:orca")?!1:!!b}function l(a){return a.getAttachmentCount()?i:h}function m(a){return"deferred_attachment:"+a.getUUID()}function n(a){var b=parseInt(a.getAuthorFBID(),10);return a.getWorkForeignParticipantIds().indexOf(b)>-1}e.exports=a}),null);