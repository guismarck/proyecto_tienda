if (self.CavalryLogger) { CavalryLogger.start_js(["UyODi"]); }

__d("IrisProtocolMessageLifetime",[],(function(a,b,c,d,e,f){e.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:3e4,TTL_1MINUTE:6e4,TTL_3MINUTES:18e4,TTL_5MINUTES:3e5,TTL_10MINUTES:6e5,TTL_15MINUTES:9e5,TTL_30MINUTES:18e5,TTL_1HOUR:36e5,TTL_2HOURS:72e5,TTL_4HOURS:144e5,TTL_8HOURS:288e5,TTL_12HOURS:432e5,TTL_24HOURS:864e5,TTL_36HOURS:1296e5,TTL_72HOURS:2592e5}}),null);
__d("MessagingTag",[],(function(a,b,c,d,e,f){e.exports={ACTION_ARCHIVED:"action:archived",INBOX:"inbox",MARKETPLACE_FOLDER:"marketplace_folder",PENDING:"pending",MONTAGE:"montage",OTHER:"other",EVENT:"event",SENT:"sent",SPAM:"spam",UPDATES:"broadcasts_inbox",BCC:"header:bcc",FILTERED_CONTENT:"filtered_content",FILTERED_CONTENT_BH:"filtered_content_bh",FILTERED_CONTENT_ACCOUNT:"filtered_content_account",FILTERED_CONTENT_QUASAR:"filtered_content_quasar",FILTERED_CONTENT_INVALID_APP:"filtered_content_invalid_app",UNAVAILABLE_ATTACHMENT:"unavailable_attachment",UNREAD:"unread",FLAGGED:"flagged",GROUPS:"groups",TRANSITIONAL_MAILBOX:"transitional_mailbox",ARCHIVED:"archived",EMAIL:"email",VOICEMAIL:"voicemail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SMS_TAG_ROOT:"SMSShortcode:",APP_ID_ROOT:"app_id:",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",MTA_SYSTEM_MESSAGE:"MTA:system_message",EMAIL_MESSAGE:"source:email",MARKETPLACE:"marketplace",ROOM:"room",PAGES:"pages",PAGE_BACKGROUND:"page_background",PAGE_FOLLOWUP:"page_followup",ONE_CLICK_MESSAGE:"page_one_click_message",MESSAGE_REQUEST_AGGREGATION_UNIT:"message_request_aggregation_unit",ONE_WAY_MESSAGE:"one_way_message",ACTION_COPIED_MESSAGE:"action:copy_message",ACTION_COPIED_SELF_MESSAGE:"copy_self_message",ACTION_COPIED_ATTACHMENT:"action:copy_attachment",ACTION_COPIED_SELF_ATTACHMENT:"copy_self_attachment",IRIS_MAPPING:{FOLDER_INVALID:null,FOLDER_INBOX:"inbox",FOLDER_OTHER:"other",FOLDER_SPAM:"spam",FOLDER_PENDING:"pending",FOLDER_MONTAGE:"montage",FOLDER_HIDDEN:"hidden",FOLDER_DISABLED:"disabled",FOLDER_PAGE_BACKGROUND:"page_background",FOLDER_PAGE_DONE:"page_done",FOLDER_BLOCKED:"blocked"}}}),null);
__d("MMessageServerResourceFetcher",["KeyedCallbackManager","MRequest"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,c){this.$3=a,this.$4=c,this.$1=new(b("KeyedCallbackManager"))(),this.$2={}}var c=a.prototype;c.get=function(a,b){this.getMulti([a],function(c){b(c[a])})};c.getMulti=function(a,c){var d=this;c=!this.$1.executeOrEnqueue(a,c);if(c)return;var e=a.filter(function(a){var b=!d.$1.getResource(a)&&!d.$2[a];b&&(d.$2[a]=!0);return b});if(e.length===0)return;c=new(b("MRequest"))(this.$3(e)).setMethod("POST");c.listen("done",function(a){if(!a||!a.payload)return;a=d.$4(a.payload);a&&d.$1.addResourcesAndExecute(a)});c.listen("finally",function(a){e.forEach(function(){delete d.$2[a]})});c.send()};c.set=function(a,b){var c={};c[a]=b;this.$1.addResourcesAndExecute(c)};return a}();e.exports=a}),null);
__d("MercurySingletonProvider",["CurrentUser"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$1={},this.$2=a}var c=a.prototype;c.getForFBID=function(a){this.$1[a]||(this.$1[a]=new this.$2(a));return this.$1[a]};c.get=function(){return this.getForFBID(b("CurrentUser").getID())};c.resetAll=function(){var a=this.$1;this.$1={};return a};a.mock=function(a){throw new Error("MercurySingletonProvider.mock() must only be used in tests.")};return a}();e.exports=a}),null);
__d("XChatThreadInfoAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/chat/thread_info/",{thread_fbids:{type:"StringVector",defaultValue:[]},other_user_fbids:{type:"StringVector",defaultValue:[]}})}),null);
__d("MMessagesThreadDataStore",["ActorURI","CurrentUser","MercurySingletonProvider","MMessageServerResourceFetcher","XChatThreadInfoAsyncController"],(function(a,b,c,d,e,f){"use strict";var g=null;a=function(){a.getProvider=function(){g===null&&(g=new(b("MercurySingletonProvider"))(a));return g};a.getForFBID=function(b){return a.getProvider().getForFBID(b)};a.get=function(){return a.getProvider().get()};function a(a){this.$6=a,this.$1=new(b("MMessageServerResourceFetcher"))(function(c){c=b("XChatThreadInfoAsyncController").getURIBuilder().setStringVector("other_user_fbids",c).getURI();b("CurrentUser").getID()!==a&&(c=b("ActorURI").create(c,a));return c.toString()},function(a){return a.profiles}),this.$2=new(b("MMessageServerResourceFetcher"))(function(c){c=b("XChatThreadInfoAsyncController").getURIBuilder().setStringVector("thread_fbids",c).getURI();b("CurrentUser").getID()!==a&&(c=b("ActorURI").create(c,a));return c.toString()},function(a){return a.profiles}),this.$3={},this.$5={},this.$4={}}var c=a.prototype;c.$7=function(a,b){if(a)return this.$1;else return this.$2};c.getForNewMessage=function(a,b,c,d,e){var f=this,g=this.$7(a,b),h=a||b;g.get(h,function(a){f.$3[h]===void 0?(f.$3[h]=a.unread_count,delete a.unread_count,f.$5[c]=!0):f.$5[c]||(delete a.unread_count,f.$5[c]=!0,d?f.$3[h]=f.$3[h]+1:f.$3[h]=0),f.$4[h]===void 0&&(f.$4[h]=a.pages_is_flagged),a.thread_unread_count=f.$3[h],e(a)})};c.updateFlagStatus=function(a,b,c,d){var e=this;if(typeof c!=="boolean")return;var f=this.$7(a,b),g=a||b;f.get(g,function(a){e.$4[g]=c,d()})};c.getIsThreadFlagged=function(a,b){a=a||b;return this.$4[a]};c.clearUnreadCount=function(a,b,c){var d=this,e=this.$7(a,b),f=a||b;e.get(f,function(a){d.$3[f]=0,c()})};c.clearAllUnread=function(){this.$3={}};return a}();e.exports=a}),null);
__d("XChatUserInfoAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/chat/user_info/",{ids:{type:"IntVector",defaultValue:[]}})}),null);
__d("MShortProfiles",["MMessageServerResourceFetcher","XChatUserInfoAsyncController"],(function(a,b,c,d,e,f){"use strict";var g=new(b("MMessageServerResourceFetcher"))(function(a){return b("XChatUserInfoAsyncController").getURIBuilder().setIntVector("ids",a.map(Number)).getURI().toString()},function(a){return a.profiles});a={get:function(a,b){g.get(a,b)},getMulti:function(a,b){g.getMulti(a,b)},set:function(a,b){g.set(a,b)}};e.exports=a}),null);
__d("MMessagesChannelPayloadPreparer",["Promise","MercuryIDs","MMessagePayload","MMessagesConfig","MMessagesThreadDataStore","MShortProfiles","Stratcom","promiseDone"],(function(a,b,c,d,e,f){"use strict";a={fetchDataThenDispatch:function(a){a.message.folder=a.folder;a.message.sender_fbid=b("MercuryIDs").getUserIDFromParticipantID(a.message.author);b("MMessagesConfig").msite_genie_xma_rendering&&this._processGenieMessage(a.message);var c=a.targetFBID?a.targetFBID:a.realtime_viewer_fbid.toString(),d=[new(b("Promise"))(function(d,e){e=b("MMessagesThreadDataStore").getForFBID(c);e.getForNewMessage(a.message.other_user_fbid,a.message.thread_fbid,a.message.message_id,a.message.is_unread,function(a){d(a)})}),new(b("Promise"))(function(c,d){b("MShortProfiles").get(a.message.sender_fbid.toString(),function(a){c(a)})})];b("promiseDone")(b("Promise").all(d),function(c){var d=c[0];c=c[1];Object.assign(a.message,{is_muted:d.mute_until!==void 0,thread_name:d.thread_name,participant_ids:d.participant_ids,has_thread_image:d.has_thread_image,work_foreign_participant_ids:d.work_foreign_participant_ids,is_canonical:d.is_canonical,href:d.href,thread_unread_count:d.thread_unread_count,pages_is_flagged:d.pages_is_flagged,sender_name:c.name,type:a.type});a.parsedPayload=new(b("MMessagePayload"))(a.message);b("Stratcom").invoke(a.type,null,a)})},_processGenieMessage:function(a){if(!a.has_attachment||!a.attachments)return;for(var b=a.attachments.length-1;b>=0;b-=1){var c=a.attachments[b];if(!c.share||!c.share.style_list||c.share.style_list[0]!="genie_message")continue;c.share.target.genie_id&&(a.sender_fbid=c.share.target.genie_id,a.sender="fbid:"+c.share.target.genie_id);c.share.target.genie_name&&(a.sender_name=c.share.target.genie_name);c.share.target&&!c.share.target.attachment&&(a.attachments.splice(b,1),a.has_attachment=a.attachments.length>0)}}};e.exports=a}),null);
__d("MMessagesReadReceipts",[],(function(a,b,c,d,e,f){"use strict";var g=void 0,h={};function a(a,b){g=a,h=b}function b(a,b){if(a!==g)return;for(var c in b){if(!Object.prototype.hasOwnProperty.call(b,c))continue;a=b[c].action;var d=h[c].action;d===void 0?h[c]=b[c]:h[c]=Math.max(d,a)===d?h[c]:b[c]}}function c(a,b,c){if(a!==g)return{};a={};for(var d in h){if(!Object.prototype.hasOwnProperty.call(h,d))continue;else if(c.indexOf(d)!==-1)continue;else if(h[d].action<b)continue;a[d]=h[d].action}return a}e.exports={init:a,update:b,getSeenBy:c}}),null);
__d("MercuryMessageCustomizations",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=JSON.parse(a),c=[];Object.keys(b).forEach(function(a){c.push({customization_type:a,customization_value:b[a]})});return c}e.exports={parseCustomizations:a}}),null);
__d("MercuryProfileRanges",[],(function(a,b,c,d,e,f){"use strict";function g(a){return!a.id&&a.i?{id:a.i,offset:a.o,length:a.l,type:a.t}:a}e.exports={extractFromDelta:function(a){a=(a=a)!=null?(a=a.data)!=null?a.prng:a:a;if(!a)return[];var b=[];try{b=JSON.parse(a);if(b.length>0)return b.map(g)}catch(a){}return b}}}),null);
__d("MessageThreadReadState",[],(function(a,b,c,d,e,f){"use strict";a={MARK_READ:1,MARK_UNREAD:2,KEEP_AS_IS:3};e.exports=a}),null);
__d("MessageThreadReadStateEffect",["MessageThreadReadState"],(function(a,b,c,d,e,f){"use strict";a=function(a,c){var d=c.messageMetadata.threadReadStateEffect;if(d!=null){var e=b("MessageThreadReadState")[d];return e===void 0&&typeof d==="number"?d:e}d=c.messageMetadata.skipBumpThread;return d===!0?b("MessageThreadReadState").KEEP_AS_IS:a!==c.messageMetadata.actorFbId?b("MessageThreadReadState").MARK_UNREAD:b("MessageThreadReadState").KEEP_AS_IS};e.exports={extractThreadStateEffectFromDelta:a}}),null);
__d("MMercurySyncNewMessageTransformer",["IrisProtocolMessageLifetime","MercuryIDs","MercuryMessageCustomizations","MercuryProfileRanges","MessageThreadReadState","MessageThreadReadStateEffect","MessagingTag"],(function(a,b,c,d,e,f){"use strict";var g=b("MessageThreadReadStateEffect").extractThreadStateEffectFromDelta,h=function(a){var b={};try{b=JSON.parse(a)}catch(a){}return b instanceof Array?b[0]:b};function a(a,c){var d=parseInt(c.messageMetadata.timestamp,10),e=c.messageMetadata.skipBumpThread,f=g(a,c);a=f===b("MessageThreadReadState").MARK_UNREAD&&a!==c.messageMetadata.actorFbId;var i=[];c.attachments&&(i=c.attachments.map(function(a){return a.mercury}));var j=c.messageMetadata.tags?c.messageMetadata.tags[0]:void 0;return{message_id:c.messageMetadata.messageId,threading_id:null,offline_threading_id:c.messageMetadata.offlineThreadingId,author:b("MercuryIDs").getParticipantIDFromUserID(c.messageMetadata.actorFbId),author_email:c.messageMetadata.actorFbId+"@facebook.com",ephemeral_ttl_mode:c.ttl?b("IrisProtocolMessageLifetime")[c.ttl]:0,timestamp:d,is_unread:a,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,source:j,tags:c.messageMetadata.tags,is_spoof_warning:!1,folder:b("MessagingTag").INBOX,thread_fbid:c.messageMetadata.threadKey.threadFbId,other_user_fbid:c.messageMetadata.threadKey.otherUserFbId,body:c.body!==void 0?c.body:"",html_body:null,subject:null,has_attachment:i.length>0,attachments:i,ranges:void 0,thread_id:null,action_type:"ma-type:user-generated-message",is_from_iris:!0,is_sponsored:!!(c.data&&c.data.is_sponsored&&c.data.is_sponsored==="true")||!!(c.untypedData&&c.untypedData.is_sponsored&&c.untypedData.is_sponsored==="true"),commerce_message_type:c.data?c.data.commerce_message_type:null,customizations:c.data&&c.data.customization?b("MercuryMessageCustomizations").parseCustomizations(c.data.customization):null,platform_xmd:c.data&&c.data.platform_xmd?c.data.platform_xmd:null,profile_ranges:b("MercuryProfileRanges").extractFromDelta(c),message_source:c.data&&c.data.message_source_data?h(c.data.message_source_data).message_source:null,skip_bump_thread:e,thread_read_state_effect:f,montage_reply_data:c.data&&c.data.montage_reply_data?h(c.data.montage_reply_data):null,meta_ranges:c.data&&c.data.meta_ranges?h(c.data.meta_ranges):null}}e.exports={transform:a}}),null);
__d("MMercurySyncReplaceMessageTransformer",["MMercurySyncNewMessageTransformer"],(function(a,b,c,d,e,f){"use strict";function a(a,c){c=Object.assign({},c.newMessage,c);return Object.assign(b("MMercurySyncNewMessageTransformer").transform(a,c),{action_type:"ma-type:replace-message",replaced_message_id:c.replacedMessageId})}e.exports={transform:a}}),null);
__d("MMercuryUnsendMessageProcessor",[],(function(a,b,c,d,e,f){"use strict";function a(){document.location.reload()}e.exports={process:a}}),null);
__d("MReplaceMessageProcessor",[],(function(a,b,c,d,e,f){"use strict";function a(a){}e.exports={process:a}}),null);
__d("MercurySyncDeltaTypes",[],(function(a,b,c,d,e,f){"use strict";a={AdminAddedToGroupThread:"AdminAddedToGroupThread",AdminRemovedFromGroupThread:"AdminRemovedFromGroupThread",AdminTextMessage:"AdminTextMessage",ChangeViewerStatus:"ChangeViewerStatus",DeliveryReceipt:"DeliveryReceipt",ForcedFetch:"ForcedFetch",MarkRead:"MarkRead",MarkUnread:"MarkUnread",MarkFolderSeen:"MarkFolderSeen",MessageDelete:"MessageDelete",NewMessage:"NewMessage",NoOp:"NoOp",PagesManagerEvent:"PagesManagerEvent",ParticipantLeftGroupThread:"ParticipantLeftGroupThread",ParticipantsAddedToGroupThread:"ParticipantsAddedToGroupThread",ReadReceipt:"ReadReceipt",ReplaceMessage:"ReplaceMessage",ThreadAction:"ThreadAction",ThreadDelete:"ThreadDelete",ThreadFolder:"ThreadFolder",ThreadMuteSettings:"ThreadMuteSettings",ThreadName:"ThreadName",JoinableMode:"JoinableMode",ApprovalMode:"ApprovalMode",ApprovalQueue:"ApprovalQueue",ClientPayload:"ClientPayload",GenieMessage:"GenieMessage",MontageMessage:"MontageMessage",RtcCallData:"RtcCallData"};e.exports=a}),null);
__d("MercurySyncMarkFolderSeenTransformer",["MessagingTag"],(function(a,b,c,d,e,f){"use strict";function a(a){return a.folders.map(function(c){return{action_type:"mga-type:mark-all-seen",folder:b("MessagingTag").IRIS_MAPPING[c],timestamp:parseInt(a.timestamp,10)}})}e.exports={transform:a}}),null);
__d("MercurySyncMarkReadTransformer",["MessagingTag"],(function(a,b,c,d,e,f){"use strict";function a(a){return a.folders&&a.folders.length>0?a.folders.map(function(c){return{action_type:"mga-type:mark-all-read",action_id:null,folder:b("MessagingTag").IRIS_MAPPING[c],timestamp:parseInt(a.watermarkTimestamp,10)}}):a.threadKeys.map(function(c){return{action_type:"ma-type:change_read_status",other_user_fbid:c.otherUserFbId,thread_fbid:c.threadFbId,mark_as_read:!0,timestamp:parseInt(a.watermarkTimestamp,10),folder:b("MessagingTag").INBOX}})}e.exports={transform:a}}),null);
__d("MercurySyncMarkUnreadTransformer",["MessagingTag"],(function(a,b,c,d,e,f){"use strict";function a(a){return a.threadKeys.map(function(c){return{action_type:"ma-type:change_read_status",other_user_fbid:c.otherUserFbId,thread_fbid:c.threadFbId,mark_as_read:!1,timestamp:parseInt(a.watermarkTimestamp,10),folder:b("MessagingTag").INBOX}})}e.exports={transform:a}}),null);
__d("MercurySyncPagesManagerEventTransformer",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=JSON.parse(a.jsonBlob),c=b&&b.type;if(!c)return void 0;switch(c){case 1:c=!!(b&&b.flagData&&b.flagData.state);b={action_type:"ma-type:change_flag",mark_as_flag:c,other_user_fbid:a.threadKey.otherUserFbId,thread_fbid:a.threadKey.threadFbId};return b;default:return void 0}}e.exports={transform:a}}),null);
__d("MercurySyncReadReceiptTransformer",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b={watermark:parseInt(a.watermarkTimestampMs,10),action:parseInt(a.actionTimestampMs,10)},c=a.threadKey.otherUserFbId||a.actorFbId;a=a.threadKey.otherUserFbId||a.threadKey.threadFbId;var d={roger:{}};d.roger[a]={};d.roger[a][c]=b;return d}e.exports={transform:a}}),null);
__d("MMercurySyncDispatcher",["BanzaiODS","ChannelEventType","CurrentUser","MercurySingletonProvider","MercurySyncDeltaTypes","MercurySyncMarkFolderSeenTransformer","MercurySyncMarkReadTransformer","MercurySyncMarkUnreadTransformer","MercurySyncPagesManagerEventTransformer","MercurySyncReadReceiptTransformer","MessagingTag","MMercurySyncNewMessageTransformer","MMercurySyncReplaceMessageTransformer","MMercuryUnsendMessageProcessor","MMessagesChannelPayloadPreparer","MMessagesReadReceipts","MMessagesThreadDataStore","MReplaceMessageProcessor","Stratcom","emptyFunction"],(function(a,b,c,d,e,f){"use strict";var g=null;a=function(){a.getProvider=function(){g===null&&(g=new(b("MercurySingletonProvider"))(a));return g};a.getForFBID=function(b){return a.getProvider().getForFBID(b)};a.get=function(){return a.getProvider().get()};function a(a){this.$1=a,this.$2=b("CurrentUser").getAccountID()===this.$1?b("ChannelEventType").MESSAGE:b("ChannelEventType").PAGES_MESSAGE}var c=a.prototype;c.process=function(a,c){var d=this,e="none";a!=null&&a["class"]!=null&&a["class"]!=""&&(e=a["class"]);b("BanzaiODS").bumpEntityKey(2966,"SyncDispatcher","receive."+c+"."+e);if(c==="cp")return;switch(a["class"]){case b("MercurySyncDeltaTypes").NewMessage:e=b("MMercurySyncNewMessageTransformer").transform(this.$1,a);c={message:e,type:this.$2,folder:b("MessagingTag").INBOX,targetFBID:this.$1};b("MMessagesChannelPayloadPreparer").fetchDataThenDispatch(c);break;case b("MercurySyncDeltaTypes").MarkUnread:e=b("MercurySyncMarkUnreadTransformer").transform(a);e.map(function(a){c={message:a,type:d.$2,event:"unread",is_sync:!0,targetFBID:d.$1},b("Stratcom").invoke(c.type,null,c)});break;case b("MercurySyncDeltaTypes").MarkRead:e=b("MercurySyncMarkReadTransformer").transform(a);e.map(function(a){a.action_type==="mga-type:mark-all-read"?b("MMessagesThreadDataStore").getForFBID(d.$1).clearAllUnread():b("MMessagesThreadDataStore").getForFBID(d.$1).clearUnreadCount(a.other_user_fbid,a.thread_fbid,b("emptyFunction")),c={message:a,type:d.$2,event:a.action_type==="mga-type:mark-all-read"?"mark_all_read":"read",is_sync:!0,targetFBID:d.$1},b("Stratcom").invoke(c.type,null,c)});break;case b("MercurySyncDeltaTypes").MarkFolderSeen:e=b("MercurySyncMarkFolderSeenTransformer").transform(a);e.map(function(a){c={message:a,type:d.$2,event:"mark_all_seen",is_sync:!0,targetFBID:d.$1},b("Stratcom").invoke(c.type,null,c)});break;case b("MercurySyncDeltaTypes").ReadReceipt:e=b("MercurySyncReadReceiptTransformer").transform(a);var f=Object.keys(e.roger)[0],g=e.roger[f];b("MMessagesReadReceipts").update(f,g);c={message:e,type:this.$2,event:"read_receipt",is_sync:!0,targetFBID:this.$1};b("Stratcom").invoke(c.type,null,c);break;case b("MercurySyncDeltaTypes").PagesManagerEvent:e=b("MercurySyncPagesManagerEventTransformer").transform(a);if(!e||e.action_type!=="ma-type:change_flag")return;b("MMessagesThreadDataStore").getForFBID(this.$1).updateFlagStatus(e.other_user_fbid,null,e.mark_as_flag,b("emptyFunction"));c={event:b("ChannelEventType").PAGE_THREAD_FLAG_CHANGED,flagged:e.mark_as_flag,other_user_fbid:e.other_user_fbid,type:b("ChannelEventType").PAGES_MESSAGE};b("Stratcom").invoke(c.type,null,c);break;case b("MercurySyncDeltaTypes").ReplaceMessage:e=b("MMercurySyncReplaceMessageTransformer").transform(this.$1,a);c={message:e,type:this.$2,folder:b("MessagingTag").INBOX,targetFBID:this.$1};b("MReplaceMessageProcessor").process(c);b("Stratcom").invoke(c.type,null,c);break;case b("MercurySyncDeltaTypes").ClientPayload:f=JSON.parse(String.fromCharCode.apply(null,a.payload));g=f&&f.deltas;if(g.length>0){a=g[0];if(a.deltaMessageReply){f=a.deltaMessageReply.message;e=b("MMercurySyncNewMessageTransformer").transform(this.$1,f);c={message:e,type:this.$2,folder:b("MessagingTag").INBOX,targetFBID:this.$1};b("MMessagesChannelPayloadPreparer").fetchDataThenDispatch(c)}a.deltaRecallMessageData&&b("MMercuryUnsendMessageProcessor").process()}break;default:break}};return a}();e.exports=a}),null);
__d("SyncProtocolConstants",[],(function(a,b,c,d,e,f){a={IRIS_CURSOR_LIMIT:"IRIS_CURSOR_LIMIT",SNAPSHOT_FAILURE:"SNAPSHOT_FAILURE"};e.exports=a}),null);
__d("SyncProtocolClient",["Int64","MercurySingletonProvider","MqttEnv","SyncProtocolConstants","exponentialBackoff"],(function(a,b,c,d,e,f){"use strict";var g=b("MqttEnv").Env;a=function(){a.getForFBID=function(a){return h.getForFBID(a)};function a(a){var c=this;this.$1=a;this.$2=[];this.$5=g.getLoggerInstance();this.$10=new(b("exponentialBackoff"))(function(){return c.$11()},this)}var c=a.prototype;c.getPublishMessages=function(){return this.$12()};c.init=function(a,c,d,e){var f=this;if(!c&&!e){this.$5.bumpCounter("sp_init_invalid_parameter");return this}this.$9=a;this.$8=!0;this.$3=c?b("Int64").fromString(c):null;this.$6=d;this.$7=e;this.$4=null;this.$9.subscribe("/t_ms",function(a){return f.$13(a)});this.$9.subscribe("/thread_typing",function(a){f.$14(a)});this.$9.subscribe("/orca_typing_notifications",function(a){f.$14(a)});this.$9.subscribe("/notify_disconnect",function(a){return f.$15(a)});this.connectToIris();return this};c.connectToIris=function(a){a===void 0&&(a=null),a!==null&&(this.$3=b("Int64").fromString(a)),this.$8=!0,this.$9.registerExtraConnectPayloadProvider(this)};c.$12=function(){var a;if(this.$4){if(!this.$3){this.$5.bumpCounter("connect_payload_iris_no_seq_id");return[]}a=this.$16()}else a=this.$17();this.$5.debugTrace("Sending request with MQTT Connect",JSON.stringify({topic:a.topic,payload:a.payload}));return[a]};c.$11=function(){var a;if(this.$4){if(!this.$3){this.$5.bumpCounter("subscribe_to_iris_no_seq_id");return}a=this.$16()}else a=this.$17();this.$5.debugTrace("Sending request",JSON.stringify({topic:a.topic,payload:a.payload}));this.$9.publish(a.topic,a.payload,{qos:1,skipBuffer:!0})};c.$18=function(a){var b=null;try{b=JSON.parse(a)}catch(a){this.$5.logError(a,"Unable to process data")}return b};c.$14=function(a){var b=this.$18(a);if(b==null){this.$5.logWarn("_processTypingData","Unable to process typing data");return}this.$2.forEach(function(a){typeof a.onTypingReceived==="function"&&a.onTypingReceived(b)})};c.addDeltaStreamListener=function(a){this.$2.push(a)};c.$15=function(a){this.$5.logWarn("_handleNotifyDisconnect","Disconnecting reason: "+a),this.$5.bumpCounter("notify_disconnect_"+a),a===b("SyncProtocolConstants").IRIS_CURSOR_LIMIT&&this.$19(a)};c.$19=function(a){this.$5.bumpCounter(a+"_request"),this.$4=null,this.$8=!1,this.$9.unregisterExtraConnectPayloadProvider(this),this.$2.forEach(function(b){return b.onStreamDisconnect(a)})};c.$13=function(a){a=this.$18(a);if(a==null){this.$5.logWarn("_processDeltas","Unable to process delta");return}var b={syncToken:a.syncToken,entityId:a.queueEntityId,errorCode:a.errorCode,firstSeqId:a.firstDeltaSeqId,lastSeqId:a.lastIssuedSeqId};this.$5.debugTrace("Sync data received",JSON.stringify(b));b=this.$1;a.queueEntityId!=null&&a.queueEntityId!=b?this.$5.bumpCounter("delta_for_other_fbid"):a.syncToken?this.$20(a):a.queueEntityId==null?this.$5.bumpCounter("no_fbid"):a.errorCode?this.$21(a.errorCode):this.$22(a)};c.$21=function(a){this.$5.bumpCounter("iris_queue_error."+a),this.$5.logWarn("_handleIrisError","Recevied an error code from sync protocol "+a),a==="ERROR_QUEUE_TEMPORARY_NOT_AVAILABLE"?this.$10():this.$19(a)};c.$20=function(a){var c=this,d=b("Int64").fromString(a.firstDeltaSeqId.toString());(this.$3===null||this.$3!=null&&!this.$3.equals(d))&&this.$5.bumpCounter("initial_sequence_id_mismatch");this.$4=a.syncToken;this.$3=d;this.$5.debugTrace("Sync token received",JSON.stringify({token:this.$4}));this.$9.subscribeChannelEvents({onMQTTStateChanged:function(a){a==="Connected"&&c.$10.reset()}})};c.$22=function(a){var c=a.deltas,d=this.$3;if(c&&d){var e=b("Int64").fromString(a.firstDeltaSeqId.toString());a=b("Int64").fromString(a.lastIssuedSeqId.toString());e.equals(d.add(b("Int64").ONE))?this.$23(e,a,c):e.compare(d)<0?(this.$5.bumpCounter("delta_batch_in_middle"),a.compare(d)>0&&this.$23(d.add(b("Int64").ONE),a,c)):(this.$5.bumpCounter("missing_deltas_get_diffs"),this.$11())}else this.$5.bumpCounter("process_deltas_invalid_state")};c.$23=function(a,c,d){a=a;for(var e=0;e<d.length;e++){var f=d[e],g=f["class"]||"Missing",h={seqId:a.toString(),type:g,status:""},i=1;if(g!="Missing")try{i=this.$24(f,g,a,h)}catch(a){h.status="err:"+a.message}else h.status="no type",this.$5.bumpCounter("missing_delta_type");this.$5.debugTrace("onDeltaReceived",JSON.stringify(h));a=a.add(b("Int64").fromInt(i))}this.$3=c};c.$24=function(a,c,d,e){var f=1,g="";c==="NoOp"&&(f=a.numNoOps||f,g+="n:"+f);a.irisSeqId||(a.irisSeqId=d.toString(),g+="missing seq id");var h=b("Int64").fromString(a.irisSeqId.toString())||d;h.equals(d)?g+=" seqId match":(g+=" seqId mismatch",this.$5.bumpCounter("seq_id_running_id_mismatch"));var i={type:c,payload:a};this.$2.forEach(function(a){return a.onDeltaReceived(i)});e.status=g;return f};c.$17=function(){var a={sync_api_version:10,max_deltas_able_to_process:1e3,delta_batch_size:500,encoding:"JSON",entity_fbid:this.$1,initial_titan_sequence_id:this.$3&&this.$3.toString(),device_params:this.$6,queue_position:this.$7};return{topic:"/messenger_sync_create_queue",payload:JSON.stringify(a),qos:1}};c.$16=function(){var a={sync_token:this.$4,sync_api_version:10,max_deltas_able_to_process:1e3,delta_batch_size:500,encoding:"JSON",entity_fbid:this.$1,last_seq_id:this.$3&&this.$3.toString()};return{topic:"/messenger_sync_get_diffs",payload:JSON.stringify(a),qos:1}};return a}();var h=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MMessengerMQTTConnection",["CurrentUser","FBMqttChannel","MercurySingletonProvider","MMercurySyncDispatcher","MqttLogger","SyncProtocolClient","gkx"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.$1=a,this.$2=b("MqttLogger").getInstance(),this.$3=!1}a.getForFBID=function(a){return g.getForFBID(a)};a.setUp=function(c){var d=c.fbid,e=c.irisSeqID;c.appID;c.endpoint;if(!d||!e)return;c=b("MqttLogger").getInstance();if(!b("CurrentUser").isLoggedInNow()){c.debugTrace("run","User not logged in");c.bumpCounter("mtouch.user_not_loggged_in");return}else c.bumpCounter("mtouch.setup");c=a.getForFBID(d);c.initializeDeltaStream(d,e)};var c=a.prototype;c.initializeDeltaStream=function(a,c){if(this.$3)return;this.$2.bumpCounter("MMessageMQTTConnection.initializeDeltaStream");this.$3=!0;var d=null;b("gkx")("687751")&&(d={accept_pending_deltas:!0});b("SyncProtocolClient").getForFBID(a).init(b("FBMqttChannel"),c,d).addDeltaStreamListener(this)};c.onDeltaReceived=function(a){a.type;a=a.payload;b("MMercurySyncDispatcher").getForFBID(this.$1.toString()).process(a,"mqtt")};c.onStreamDisconnect=function(a){this.$2.bumpCounter("mtouch.stream_disconnect."+a)};return a}();var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MNotificationReadAll",["CSS","DataStore","DOM","Stratcom","XAsyncRequest","ge"],(function(a,b,c,d,e,f){var g="read_all",h={},i=!1;e.exports={init:function(){if(i)return;b("Stratcom").listen("click",g,j);b("Stratcom").listen("m:page:render:cache:complete",null,k);i=!0}};function j(){var a=b("ge")("notifications_list");if(!a)return;l(a)}function k(a){if(a.getData().path.indexOf("notifications")>-1)for(var b in h){a=document.getElementById(b);a&&m(a)}}function l(a){a=b("DOM").scry(a,"div","notification marea");if(!a)return;function c(c,a){c=b("DataStore").get(c,"notif_id");typeof c==="number"&&(h[c.toString()]=!0);m(a)}for(var a=a,d=Array.isArray(a),e=0,a=d?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;if(b("CSS").hasClass(f,"aclb")){var g=b("DOM").find(f,"a");c(g,f)}}new(b("XAsyncRequest"))().setURI("/a/jewel_notifications_read.php").setMethod("POST").setData({ids:Object.keys(h),seen:!1}).send()}function m(a){b("CSS").addClass(a,"acw"),b("CSS").removeClass(a,"aclb")}}),null);
__d("SecurePostMessage",["invariant"],(function(a,b,c,d,e,f,g){"use strict";var h="*";a={sendMessageToSpecificOrigin:function(a,b,c,d){c!==h||g(0,21157),a.postMessage(b,c,d)},sendMessageForCurrentOrigin:function(a,b){a.postMessage(b)},sendMessageAllowAnyOrigin_UNSAFE:function(a,b,c){a.postMessage(b,h,c)}};e.exports=a}),null);
__d("XBrowserPushXOutController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/notifications/client/push/xout/",{})}),null);
__d("XPushRegisterServiceWorkerController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/push/register/service_worker/",{})}),null);
__d("MNotificationsPushInstall",["Promise","BanzaiLogger","DOM","KaiOSController","MobileAppDetect","MPushPermissionUtil","MRequest","PushRegistration","SecurePostMessage","Stratcom","URI","XBrowserPushXOutController","XPushRegisterServiceWorkerController"],(function(a,b,c,d,e,f){var g;function h(a,c,d){a={event:a,appid:c,surface:d};b("BanzaiLogger").log("BrowserPushLoggerConfig",a)}function i(a){b("Stratcom").invoke(a),window.parent&&b("SecurePostMessage").sendMessageAllowAnyOrigin_UNSAFE(window.parent,a)}function j(a){if(!a)return!1;a=new(g||(g=b("URI")))(a).getDomain();return!a||a===window.location.hostname?!1:!0}a={installHandler:function(a,c){h("turn_on",a.appID,c);var d;b("MobileAppDetect").is_kaios?d=a.registerPushOnKaiOS(b("XPushRegisterServiceWorkerController"),b("MRequest"),b("KaiOSController")):(b("MPushPermissionUtil").logEvent("turn_on_attempt"),b("PushRegistration").pushPermissionIsPending()&&b("Stratcom").invoke("m:notifications:push:install:showCurtain"),d=new(b("Promise"))(function(c,d){return a.registerPush(b("XPushRegisterServiceWorkerController"),b("MRequest"),function(){},!0,c)["catch"](d)}));return new(b("Promise"))(function(e,f){d.then(function(){b("Stratcom").invoke("m:notifications:push:install:hideCurtain");b("MPushPermissionUtil").logEvent("allow");h("install",a.appID,c);e(!0);i("m:notifications:push:install:installed");return})["catch"](function(d){b("Stratcom").invoke("m:notifications:push:install:hideCurtain");window.Notification&&window.Notification.permission==="denied"?(b("MPushPermissionUtil").logEvent("deny"),h("deny",a.appID,c)):(b("MPushPermissionUtil").logEvent("install_ignore"),h("install_ignore",a.appID,c));i("m:notifications:push:install:notInstalled");f(d);return})})},xoutHandler:function(a,c){return new(b("Promise"))(function(d,e){h("xout",a.appID,c);var f=b("XBrowserPushXOutController").getURIBuilder().getURI();f=new(b("MRequest"))(f);f.setMethod("POST");f.listen("finally",d);f.listen("fail",e);f.send()})},registerOnHostIfNeeded:function(a){return new(b("Promise"))(function(c,d){var e;if(!j(a)){c(!1);return}var f=b("DOM").create("iframe",{style:{height:"1px",width:"1px",display:"none"}});f.id="PushIframe";b("DOM").appendContent(window.document.body,f);f.src=(e=a)!=null?e:"";e=function(a){if(a.source!==f.contentWindow)return;a.data==="m:notifications:push:install:installed"&&c(!0);a.data==="m:notifications:push:install:notInstalled"&&d(!0)};window.removeEventListener("message",e,!1);window.addEventListener("message",e,!1)})}};e.exports=a}),null);
__d("MNotificationsPushInstallCurtain",["cx","CSS","DOM","MViewport","Stratcom"],(function(a,b,c,d,e,f,g){var h="upsell_curtain",i="curtain_with_context",j=new Set(["ae","ar","arc","bcc","bqi","ckb","dv","fa","glk","he","ku","mzn","nqo","pnb","ps","sd","ug","ur","yi"]),k=null;function l(){if(k instanceof HTMLElement){var a=n(k);a&&b("CSS").show(k)}b("Stratcom").listen("click",h,m)}function m(){k instanceof HTMLElement&&b("CSS").hide(k)}a={startListening:function(a){k=a,b("Stratcom").listen("m:notifications:push:install:showCurtain",null,l),b("Stratcom").listen("m:notifications:push:install:hideCurtain",null,m)}};function n(a){if(a.id!==i)return!0;var c=b("MViewport").getHeaderElement();if(b("MViewport").getHeight()*window.devicePixelRatio<400||b("MViewport").isLandscape()||!a||!c||!c.parentNode||!c.parentNode.parentNode||c.parentNode.parentNode.id!=="page")return!1;o(a);q(a);var d=b("DOM").create("div",{position:"relative"});d.appendChild(a);b("DOM").insertAfter(c.parentNode,d);return!0}function o(a){if(p()){a=a.getElementsByClassName("_1t9n")[0];a&&b("CSS").addClass(a,"_u6u")}}function p(){var a=b("DOM").create("div");a.setAttribute("style","position: fixed; bottom: 0; height: 100vh;");b("DOM").appendContent(document.body,a);var c=a.offsetHeight>window.innerHeight&&a.offsetTop<0;b("DOM").remove(a);return c}function q(a){var b=navigator.language||" ";if(j.has(b.substring(0,2))||j.has(b.substring(0,3))){b=a.getElementsByClassName("_1f0e")[0];b&&(b.className="_1f0f")}}e.exports=a}),null);
__d("MNotificationsPushUpsellFunnelLogger",["BanzaiLogger"],(function(a,b,c,d,e,f){a={log:function(a,c,d,e){a={attemptid:a,stage:c,appid:d,surface:e};b("BanzaiLogger").log("BrowserPushRegistrationFlowLoggerConfig",a)}};e.exports=a}),null);
__d("MToastAction",["cx","CSS","DOM","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){"use strict";var h={showToast:function(a,c){var d=b("DOM").create("div",null,a);b("DOM").appendContent(document.body,d);b("setTimeoutAcrossTransitions")(function(){return b("CSS").addClass(d,"_4zke")},c);b("setTimeoutAcrossTransitions")(function(){return b("DOM").remove(d)},c+1e3)},showDefaultToast:function(a,c){a=b("DOM").create("div",{className:"_3fcy"},a);a=b("DOM").create("div",{className:"_2jow _3fc-"},a);h.showToast(a,c)}};e.exports=h}),null);
__d("QPEventHandling",[],(function(a,b,c,d,e,f){"use strict";a={registerClickListener:function(a,b,c){a.addEventListener("click",c)}};e.exports=a}),null);
__d("XQuickPromotionSimpleLoggingController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/qp/action/log/",{qp_id:{type:"Int",required:!0},qp_action:{type:"Enum",enumType:1},qp_instance_log_data:{type:"StringToStringMap",defaultValue:{}},qp_event:{type:"String"}})}),null);
__d("QPRenderer",["csx","CSS","FBLogger","Parent","QPEventHandling","XAsyncRequest","XQuickPromotionSimpleLoggingController","ge"],(function(a,b,c,d,e,f,g){"use strict";function h(a,c,d){a=b("XQuickPromotionSimpleLoggingController").getURIBuilder().setInt("qp_id",a).setString("qp_event",c).setStringToStringMap("qp_instance_log_data",d).getURI();new(b("XAsyncRequest"))(a).send()}function a(a,c,d){a=b("XQuickPromotionSimpleLoggingController").getURIBuilder().setInt("qp_id",a).setEnum("qp_action",c).setStringToStringMap("qp_instance_log_data",d).getURI();new(b("XAsyncRequest"))(a).send()}function c(a,c,d,e,f,g){e=b("ge")(e);e!==null?i(a,d,e,g,function(){f&&b("CSS").hide(c)}):b("FBLogger")("quick_promotion").mustfix("Quick Promotion %s is missing %s action element.",a,d)}function d(a,c,d,e,f){i(a,c,d,f,function(){if(e){var a=b("Parent").bySelector(d,"._5jmm");a instanceof HTMLElement&&b("CSS").hide(a)}})}function e(a,c,d){c.show();h(a,"view",{});c.subscribe("cancel",function(){h(a,"dialog_cancel",{})});for(var e=0;e<d.length;e++){var f=d[e],g=b("ge")(f.element_id);g!==null?(i(a,f.action,g,f.extra_log_data,f.should_close?function(){c.hide()}:function(){}),f.action=="primary"&&g.focus()):b("FBLogger")("quick_promotion").mustfix("Quick Promotion %s is missing %s action element.",a,f.action)}}function i(a,c,d,e,f){b("QPEventHandling").registerClickListener(d,c,function(){var d=b("XQuickPromotionSimpleLoggingController").getURIBuilder().setInt("qp_id",a).setEnum("qp_action",c).setStringToStringMap("qp_instance_log_data",e).getURI();new(b("XAsyncRequest"))(d).send();f()})}f.setAction=c;f.setComponentActionForFeedUnitQP=d;f.setDialogActionsAndShow=e;f.logAction=a;f.logEvent=h}),null);
__d("MNotificationsPushUpsellInstaller",["fbt","MJewels","MNotificationsPushInstall","MNotificationsPushUpsellFunnelLogger","MToastAction","PushRegistration","QE2Logger","QPRenderer","Stratcom","isVisible"],(function(a,b,c,d,e,f,g){var h=null,i=null,j=null,k=function(a){j&&j(a)},l=function(a,c,d,e,f,g){if(b("PushRegistration").pushPermissionIsDenied())return!1;if(f){b("QE2Logger").logExposureForUser(f);if(g)return!1}j=function(a){b("MNotificationsPushUpsellFunnelLogger").log(d,a,c,e)};i=e;h=b("PushRegistration").get(a,c);return!0},m=function(){if(h===null||i===null)return;k("try_install");b("MNotificationsPushInstall").installHandler(h,i).then(function(){k("install_success"),b("MToastAction").showDefaultToast(g._("Notificaciones de Facebook activadas"),3e3)})["catch"](function(){h!==null&&i!==null&&(b("PushRegistration").pushPermissionIsDenied()?(k("system_dialog_deny"),b("MNotificationsPushInstall").xoutHandler(h,i)):k("system_dialog_ignore"))})},n=function(a){k("impression"),b("QPRenderer").logEvent(a,"view",{}),k(b("PushRegistration").pushPermissionIsDenied()?"permissions_blocked":"permissions_unblocked")},o="m:qp:push-notifications:log-impression",p={invokeImpressionEvent:function(){b("Stratcom").invoke(o)},installOnUpsellClick:function(a,c,d,e,f,g,h,i,j,q){if(!l(a,c,f,g,j,q))return!1;b("isVisible")(i)?n(h):(b("Stratcom").listen(o,null,function(){b("Stratcom").removeCurrentListener(),n(h)}),b("Stratcom").listen("m:jewel:flyout:open",null,function(a){a.getData().jewel===b("MJewels").NOTIFICATIONS&&(b("Stratcom").removeCurrentListener(),p.invokeImpressionEvent())}));b("Stratcom").listen("click",d,function(){k("action_turn_on"),b("PushRegistration").pushPermissionIsDenied()?k("error_permissions_blocked"):m()});b("Stratcom").listen("click",e,function(){k("action_not_now")});return!0},installDirectFromUpsell:function(a,c,d,e,f,g,h){l(a,c,e,f,g,h)&&(p.invokeImpressionEvent(),b("QPRenderer").logEvent(d,"view",{}),m())},install:function(a){if(b("PushRegistration").pushPermissionIsDenied())return;a.isInControlGroup||(a.promotionContainerNode.style.display="block");p.installOnUpsellClick(a.path,a.appID,a.installButtonSigil,a.notNowButtonSigil,a.installAttemptID,a.surface,a.promotionID,a.promotionContainerNode,a.qeUniverseName,a.isInControlGroup)}};e.exports=p}),null);
__d("MNotificationsDirectPrompt",["Promise","MNotificationsPushInstall","MNotificationsPushInstallCurtain","MNotificationsPushUpsellInstaller","MobileAppDetect","MPushPermissionUtil","MRequest","PushRegistration","Stratcom","XBrowserPushDisabledController","XPushRegisterServiceWorkerController","gkx","goURI","promiseDone"],(function(a,b,c,d,e,f){a={installPush:function(a){a.curtain&&b("MNotificationsPushInstallCurtain").startListening(a.curtain);var c=b("PushRegistration").get(a.path,a.appID);if(b("MobileAppDetect").is_kaios){var d=b("gkx")("854369");(d||!a.isInstalled)&&!a.wasXOuted&&b("MNotificationsPushInstall").installHandler(c,"prompt");return}a.wasXOuted&&a.upsell?b("MNotificationsPushUpsellInstaller").installDirectFromUpsell(a.path,a.appID,a.upsell.promotionID,a.upsell.installAttemptID,a.upsell.surface,a.upsell.qeUniverseName,a.upsell.isInControlGroup):b("MPushPermissionUtil").logEvent("fresh_nonupsell_promo");var e=b("Promise").resolve(),f=function(){a.redirectUrl&&window.location!==a.redirectUrl&&(a.isNuxPrompt===!0?b("goURI")(a.redirectUrl,!1,!0):b("goURI")(a.redirectUrl+"?_rdr",!1,!0))};b("promiseDone")(b("MNotificationsPushInstall").registerOnHostIfNeeded(a.enabledUrl).then(function(d){if(d){b("MPushPermissionUtil").logEvent("already_registered");return}c.isPushRegistered(a.isInstalled,b("XPushRegisterServiceWorkerController"),b("XBrowserPushDisabledController"),b("MRequest"),a.registerAnyway,!0).then(function(d){a.wasXOuted?b("MPushPermissionUtil").logEvent("previously_xouted"):a.isInstalled&&d&&b("MPushPermissionUtil").logEvent("already_installed"),(!a.isInstalled||!d)&&!a.wasXOuted?b("MNotificationsPushInstall").installHandler(c,"prompt")["catch"](function(){e=b("MNotificationsPushInstall").xoutHandler(c,"prompt")})["finally"](function(){return e.then(f)}):f()},function(a){b("MPushPermissionUtil").logEvent("push_regn_failure")})},function(a){b("MPushPermissionUtil").logEvent("recently_rejected")}))}};e.exports=a}),null);
__d("XBrowserPushRegistrationController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/push/permissions/",{})}),null);
__d("MNotificationsUpdatePermissionStatus",["MRequest","XBrowserPushRegistrationController"],(function(a,b,c,d,e,f){"use strict";a={updateIfNeeded:function(a){if(a.host!==window.location.hostname)return;window.Notification&&window.Notification.permission!==a.state&&this._updateRegistration(window.location.hostname,window.Notification.permission)},_updateRegistration:function(a,c){var d=b("XBrowserPushRegistrationController").getURIBuilder().getURI();d=new(b("MRequest"))(d);d.setData({host:a,state:c});d.setMethod("POST");d.send()}};e.exports=a}),null);